<!DOCTYPE html><html><head><title>Drag and drop - Yue</title><style>body {margin: 0;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";font-size: 14px;word-wrap: break-word;line-height: 1.5;color: #24292e;}a {color: #0366d6;text-decoration: none;}a:hover {text-decoration: underline;}.markdown-body {padding: 45px;}#header {width: 100%;height: 50px;line-height: 50px;background-color: #3b73d4;}#header .logo {font-weight: 700;font-size: 30px;color: white;display: inline-block;padding-left: 45px;padding-right: 45px;margin: 0;}#header .nav {position: absolute;right: 45px;top: 0;}#header .nav a {margin-left: 30px;color: white;}#footer {height: 30px;width: 100%;background-color: #3b73d4;}#footer p {padding-left: 45px;line-height: 30px;color: white;}.markdown-body::before {display: table;content: "";}.markdown-body::after {display: table;clear: both;content: "";}.markdown-body * {box-sizing: border-box;}.markdown-body>*:first-child {margin-top: 0 !important;}.markdown-body>*:last-child {margin-bottom: 0 !important;}.markdown-body strong {font-weight: 600;}.markdown-body hr {height: 0;margin: 15px 0;overflow: hidden;background: transparent;border: 0;border-bottom: 1px solid #dfe2e5;}.markdown-body hr::before {display: table;content: "";}.markdown-body hr::after {display: table;clear: both;content: "";}.markdown-body dd {margin-left: 0;}.markdown-body a:not([href]) {color: inherit;text-decoration: none;}.markdown-body p,.markdown-body blockquote,.markdown-body ul,.markdown-body ol,.markdown-body dl,.markdown-body table,.markdown-body pre {margin-top: 0;margin-bottom: 16px;}.markdown-body blockquote {margin: 0;padding: 0 1em;color: #6a737d;border-left: 0.25em solid #dfe2e5;}.markdown-body blockquote>:first-child {margin-top: 0;}.markdown-body blockquote>:last-child {margin-bottom: 0;}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6 {margin-top: 24px;margin-bottom: 16px;font-weight: 600;line-height: 1.25;}.markdown-body h1 {padding-bottom: 0.3em;font-size: 2em;border-bottom: 1px solid #eaecef;}.markdown-body h2 {padding-bottom: 0.3em;font-size: 1.5em;border-bottom: 1px solid #eaecef;}.markdown-body h3 {font-size: 1.25em;}.markdown-body h4 {font-size: 1em;}.markdown-body h5 {font-size: 0.875em;}.markdown-body h6 {font-size: 0.85em;color: #6a737d;}.markdown-body ul,.markdown-body ol {padding-left: 2em;}.markdown-body ul ul,.markdown-body ul ol,.markdown-body ol ol,.markdown-body ol ul {margin-top: 0;margin-bottom: 0;}.markdown-body ul ul ol,.markdown-body ul ol ol,.markdown-body ol ul ol,.markdown-body ol ol ol {list-style-type: lower-alpha;}.markdown-body li>p {margin-top: 16px;}.markdown-body li+li {margin-top: 0.25em;}.markdown-body dl {padding: 0;}.markdown-body dl dt {padding: 0;margin-top: 16px;font-size: 1em;font-style: italic;font-weight: 600;}.markdown-body table {display: block;width: 100%;overflow: auto;border-spacing: 0;border-collapse: collapse;}.markdown-body table th {font-weight: 600;}.markdown-body table th,.markdown-body table td {padding: 6px 13px;border: 1px solid #dfe2e5;}.markdown-body table tr {background-color: #fff;border-top: 1px solid #c6cbd1;}.markdown-body svg:not(:root) {overflow: hidden;}.markdown-body img {max-width: 100%;border-style: none;box-sizing: content-box;background-color: #fff;}.markdown-body code {padding: 0;padding-top: 0.2em;padding-bottom: 0.2em;margin: 0;font: 12px "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace;background-color: rgba(27,31,35,0.05);border-radius: 3px;}.markdown-body code::before,.markdown-body code::after {letter-spacing: -0.2em;content: "\00a0";}.markdown-body pre {font: 12px "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace;}.markdown-body pre>code {padding: 0;margin: 0;font-size: 100%;word-break: normal;white-space: pre;background: transparent;border: 0;}.markdown-body pre {padding: 16px;overflow: auto;font-size: 85%;line-height: 1.45;background-color: #f6f8fa;border-radius: 3px;word-wrap: normal;}.markdown-body pre code {display: inline;max-width: auto;padding: 0;margin: 0;overflow: visible;line-height: inherit;word-wrap: normal;background-color: transparent;border: 0;}.markdown-body pre code::before,.markdown-body pre code::after {content: normal;}.markdown-body kbd {display: inline-block;padding: 3px 5px;font: 11px "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace;line-height: 10px;color: #444d56;vertical-align: middle;background-color: #fcfcfc;border: solid 1px #c6cbd1;border-bottom-color: #959da5;border-radius: 3px;box-shadow: inset 0 -1px 0 #959da5;}.markdown-body .anchor {float: left;padding-right: 4px;margin-left: -20px;line-height: 1;}.markdown-body .anchor:focus {outline: none;}.markdown-body h1:hover .anchor svg, .markdown-body h2:hover .anchor svg,.markdown-body h3:hover .anchor svg, .markdown-body h4:hover .anchor svg,.markdown-body h5:hover .anchor svg, .markdown-body h6:hover .anchor svg {visibility: visible;}.markdown-body .anchor svg {vertical-align: middle;visibility: hidden;}/*Atom One Light by Daniel GamageOriginal One Light Syntax theme from https://github.com/atom/one-light-syntaxbase:    #fafafamono-1:  #383a42mono-2:  #686b77mono-3:  #a0a1a7hue-1:   #0184bbhue-2:   #4078f2hue-3:   #a626a4hue-4:   #50a14fhue-5:   #e45649hue-5-2: #c91243hue-6:   #986801hue-6-2: #c18401*/.hljs {display: block;overflow-x: auto;padding: 0.5em;color: #383a42;background: #fafafa;}.hljs-comment,.hljs-quote {color: #a0a1a7;font-style: italic;}.hljs-doctag,.hljs-keyword,.hljs-formula {color: #a626a4;}.hljs-section,.hljs-name,.hljs-selector-tag,.hljs-deletion,.hljs-subst {color: #e45649;}.hljs-literal {color: #0184bb;}.hljs-string,.hljs-regexp,.hljs-addition,.hljs-attribute,.hljs-meta-string {color: #50a14f;}.hljs-built_in,.hljs-class .hljs-title {color: #c18401;}.hljs-attr,.hljs-variable,.hljs-template-variable,.hljs-type,.hljs-selector-class,.hljs-selector-attr,.hljs-selector-pseudo,.hljs-number {color: #986801;}.hljs-symbol,.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-title {color: #4078f2;}.hljs-emphasis {font-style: italic;}.hljs-strong {font-weight: bold;}.hljs-link {text-decoration: underline;}#sidebar {display: none;}</style></head><body><div id="header"><a class="logo" href="../index.html">Yue</a><div class="nav"><a href="../index.html">Docs</a><a href="/">Versions</a><a href="https://github.com/yue/yue">GitHub</a></div></div><div id="container"><div class="markdown-body" id="content"><h1 id="drag-and-drop">Drag and drop</h1>
<p>Like the clipboard, drag and drop is a way to transfer data between different
applications.</p>
<p>Most operating systems implement the drag and drop system in the same way with
clipboard, and in Yue dragged data are represented as instances of the
<a href="../api/clipboard_data.html"><code>Clipboard::Data</code></a>.</p>
<p>For code examples on handling drag and drop, please see the sample app in
<a href="https://github.com/yue/yue-sample-apps/blob/master/drag_source"><code>yue-sample-apps/drag_source</code></a>.</p>
<h2 id="drag-destination">Drag destination</h2>
<p>A <code>View</code> can be made a drag destination by using the
<a href="../api/view.html#registerdraggedtypes-types"><code>View.RegisterDraggedTypes</code></a> API,
which gives the view abilities to accept dropped data.</p>
<pre><code class="lang-lua">view:registerdraggedtypes({<span class="hljs-string">'image'</span>})
</code></pre>
<p>When users drag data with registered types to the view, drag related events will
be emitted in sequence:</p>
<ol>
<li>The <a href="../api/view.html#handledragenter-self-info-point"><code>handle_drag_enter</code></a> and
<a href="../api/view.html#ondragleave-self-info"><code>on_drag_leave</code></a> will be called when the cursor enters or
leaves the view while dragging.</li>
<li>The <a href="../api/view.html#handledragupdate-self-info-point"><code>handle_drag_update</code></a> will be called while cursor
moves in the view while dragging.</li>
<li>The <a href="../api/view.html#handledrop-self-info-point"><code>handle_drop</code></a> will be called user releases cursor and
drops the data on the view.</li>
</ol>
<p>To accept dropped data, the <a href="../api/view.html#handledragenter-self-info-point"><code>handle_drag_enter</code></a> should be
implemented first to decide which <a href="../api/dragoperation.html"><code>DragOperation</code></a>
to perform when cursor is dropped. Depending on the returned drag operation,
the cursor may have different icons.</p>
<pre><code class="lang-lua"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">view.handledragenter</span><span class="hljs-params">(self, info, point)</span></span>
  isDragging = <span class="hljs-literal">true</span>
  <span class="hljs-keyword">return</span> gui.DraggingInfo.dragoperationcopy
<span class="hljs-keyword">end</span>
</code></pre>
<p>If you are implementing some visual effects when there are data being dragged to
the view, you may want to do some cleanup in <a href="../api/view.html#ondragleave-self-info"><code>on_drag_leave</code></a>,
which is called when cursor moves out of the view <em>and</em> before users drops the
data on the view.</p>
<pre><code class="lang-lua"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">view.ondragleave</span><span class="hljs-params">(self)</span></span>
  isDragging = <span class="hljs-literal">true</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>If the view supports different drag operations depending on the cursor position,
you may want to implement <a href="../api/view.html#handledragupdate-self-info-point"><code>handle_drag_update</code></a>, and return
the drag operation according to the cursor position in the view.</p>
<p>If you don&#39;t implement <a href="../api/view.html#handledragupdate-self-info-point"><code>handle_drag_update</code></a>, the return
value of previous <a href="../api/view.html#handledragenter-self-info-point"><code>handle_drag_enter</code></a> call will be used.</p>
<pre><code class="lang-lua"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">view.handledragupdate</span><span class="hljs-params">(self, info, point)</span></span>
  <span class="hljs-keyword">if</span> (pointInDragArea(point))
    <span class="hljs-keyword">return</span> gui.DraggingInfo.dragoperationcopy
  <span class="hljs-keyword">else</span>
    <span class="hljs-keyword">return</span> gui.DraggingInfo.dragoperationnone
<span class="hljs-keyword">end</span>
</code></pre>
<p>Finally, by implementing <a href="../api/view.html#handledrop-self-info-point"><code>handle_drop</code></a>, you can read the dragged
data from the passed <a href="../api/dragginginfo.html"><code>DraggingInfo</code></a> instance.</p>
<pre><code class="lang-lua"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">view.handledrop</span><span class="hljs-params">(self, info, point)</span></span>
  <span class="hljs-keyword">if</span> (info:isdataavailable(<span class="hljs-string">'image'</span>)) {
    displayImage(info:getdata(<span class="hljs-string">'image'</span>).value)
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
  }
  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
<span class="hljs-keyword">end</span>
</code></pre>
<h2 id="drag-source">Drag source</h2>
<p>To make it possible for users to drag some data from current applications to
other destinations, you can listen to mouse down events and use the
<a href="../api/view.html#dodrag-data-operations"><code>View.DoDrag</code></a> API.</p>
<pre><code class="lang-lua">source:setmousedowncanmovewindow(<span class="hljs-literal">false</span>)

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">source.onmousedown</span><span class="hljs-params">(self)</span></span>
  <span class="hljs-keyword">local</span> ret = self:doDrag({{<span class="hljs-built_in">type</span>: <span class="hljs-string">'file-paths'</span>, value: {filePath}}},
                          gui.DraggingInfo.dragoperationcopy | gui.DraggingInfo.dragoperationlink)
  <span class="hljs-keyword">if</span> (ret == gui.DraggingInfo.dragoperationcopy)
    copyData()
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ret == gui.DraggingInfo.dragoperationlink)
    linkData()
  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>The API should be called with the data to provide, and the supported drag
operations. The call will be blocked until the user cancels the dragging or
drops the data, and it will return the drag operation used by the destination.</p>
</div><div class="markdown-body" id="sidebar"></div></div><div id="footer"><p>Content of this page is in public domain.</p></div></body></html>